<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project Diablo 2 Tile Preview (act0)</title>

  <!-- Google Font: MedievalSharp for Diablo-style header -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&display=swap" rel="stylesheet">

  <style>
    /* -----------------------------
       Color variables
       ----------------------------- */
    :root {
      --bg: #0b0b0b;       /* page background base */
      --panel: #141414;    /* sidebar background */
      --border: #5a3a1a;   /* borders */
      --text: #d6c7a1;     /* main text */
      --accent: #c9a24d;   /* highlights, accents */
      --hover: #1f1f1f;    /* hover background for menu items */
    }

    /* -----------------------------
       Base styles for html/body
       ----------------------------- */
    html, body {
      margin: 0;
      height: 100%;
      background:
        url("https://www.transparenttextures.com/patterns/dark-mosaic.png"), /* subtle texture */
        radial-gradient(circle at top, #1a1208, #050302); /* dark gradient */
      color: var(--text);
      font-family: "Trebuchet MS", serif;
    }

    /* -----------------------------
       Header
       ----------------------------- */
    #header {
      font-family: 'MedievalSharp', serif; /* Diablo-like font */
      font-size: 28px;
      color: #d6c07a; /* golden color */
      text-shadow: 0 0 6px #000, 0 0 12px rgba(201,162,77,0.6); /* glowing effect */
      border-bottom: 2px solid var(--border);
      padding: 18px 16px;
      text-align: left; /* aligned left */
    }

    /* -----------------------------
       Container for sidebar + main
       ----------------------------- */
    #container {
      display: flex;
      height: calc(100% - 78px); /* subtract header + footer */
    }

    /* -----------------------------
       Sidebar
       ----------------------------- */
    #sidebar {
      flex: 0 0 280px; /* fixed width */
      background: var(--panel);
      border-right: 2px solid var(--border);
      overflow-y: auto; /* vertical scroll if content overflows */
    }

    #sidebar h3 {
      margin: 10px;
      font-size: 14px;
      color: var(--accent);
    }

    /* Sidebar menu items */
    .item {
      padding: 8px 12px;
      cursor: pointer;
      border-bottom: 1px solid #1f1f1f;
      display: flex;
      align-items: center;
    }

    .item:hover {
      background: var(--hover);
    }

    /* Sidebar icons using Unicode emojis */
    .item.folder::before { content: "\1F4C1"; margin-right: 6px; color: #d9b56a; }
    .item.file::before { content: "\1F4C4"; margin-right: 6px; color: #cfcfcf; }
    .item.back::before { content: "\2B05"; margin-right: 6px; color: var(--accent); }

    /* -----------------------------
       Main content area
       ----------------------------- */
    #main {
      flex: 1 1 auto;
      overflow: scroll; /* always visible scrollbars */
      padding: 16px;
      position: relative;
    }

    /* Breadcrumb navigation */
										 
						
					 
	 

						
										
						
						   
	 

									
				
									   
		
		   
				 
																		  
				 
  

					
    .breadcrumb {
      margin-bottom: 12px;
      font-size: 13px;
      color: var(--accent);
    }

    .breadcrumb span {
      cursor: pointer;
      text-decoration: underline dotted;
    }

    .breadcrumb span.current {
      cursor: default;
      text-decoration: none;
    }

    /* Filename display */
    .filename {
      margin: 4px 0 6px;
      font-size: 14px;
      color: var(--accent);
    }

									
    /* File content container */
									   
    #fileContent {
      width: max-content; /* allow horizontal scroll if content is wide */
      min-width: 100%;    /* at least fill main area width */
												  
    }

    /* Display images/canvas for PCX or PNG */
    #fileContent canvas,
    #fileContent img {
      display: block;
      max-width: none; /* do not shrink large images */
      margin-bottom: 24px;
      border: 1px solid var(--border);
      image-rendering: pixelated; /* preserve pixel art style */
    }

    /* Plain text files (.ini) */
    pre {
      background: #0d0d0d;
      padding: 16px;
      border: 1px solid var(--border);
      box-shadow: inset 0 0 12px #000;
      white-space: pre-wrap;
      font-family: Consolas, monospace;
      font-size: 13px;
      line-height: 1;
      color: var(--text);
    }

    /* -----------------------------
       Footer
       ----------------------------- */
    #footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
      font-size: 12px;
      padding: 8px;
      background: #0b0703;
      border-top: 2px solid var(--border);
      color: #9f8b5a;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <div id="header">Project Diablo 2 Tile Preview (act0)</div>

  <!-- Container for sidebar + main -->
  <div id="container">
    <!-- Sidebar -->
    <div id="sidebar">
      <h3>Repository</h3>
      <div id="tree"></div>
    </div>

    <!-- Main content area -->
    <div id="main">
      <!-- Breadcrumb navigation -->
      <div class="breadcrumb" id="breadcrumb"></div>

      <!-- File preview area -->
      <div id="fileContent">
        <p>Select a file to view.</p>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div id="footer">
    Graphic preview for ingame tiles - beta | v1.3 | made by Gimli
  </div>

  <script>
    // -----------------------------
    // Repository configuration
    // -----------------------------
    const owner = "D2R-Gimli";
    const repo = "Diablo2_act0_color_palette";
    const basePath = "data/global/tiles"; // starting folder
    const apiBase = `https://api.github.com/repos/${owner}/${repo}/contents`;

    const tree = document.getElementById("tree");
    const fileContent = document.getElementById("fileContent");
    const breadcrumbEl = document.getElementById("breadcrumb");

    let currentPath = basePath;
    const allowedExtensions = [".ini", ".pcx", ".png"];

    // -----------------------------
    // Load directory content from GitHub
    // -----------------------------
    async function loadDir(path = basePath) {
      currentPath = path;
      tree.innerHTML = ""; // clear previous content

      // Create a "back" button
      const back = document.createElement("div");
      back.textContent = ".. back";
      back.className = "item back";
      back.onclick = () => {
        if (currentPath === basePath) return; // do not go above base
        const parts = currentPath.split("/");
        parts.pop(); // go one level up
        const newPath = parts.join("/") || basePath;
        loadDir(newPath);
      };
      tree.appendChild(back);

      // Fetch folder contents from GitHub API
      const res = await fetch(`${apiBase}/${path}`);
      const items = await res.json();

      // Add folders/files to sidebar
      items.forEach(item => {
        // Only allow folders and specific file extensions
        if (
          item.type === "file" &&
          !allowedExtensions.some(ext => item.name.toLowerCase().endsWith(ext))
        ) return;

        const div = document.createElement("div");
        div.className = "item " + item.type;
        div.textContent = item.name;
        div.onclick = () => item.type === "dir" ? loadDir(item.path) : loadFile(item);
        tree.appendChild(div);
      });

      // Update breadcrumb
      updateBreadcrumb();
    }

    // -----------------------------
    // Update breadcrumb navigation
    // -----------------------------
    function updateBreadcrumb() {
      const parts = currentPath.split("/");
      let pathAcc = "";
      breadcrumbEl.innerHTML = ""; // clear previous breadcrumb

      parts.forEach((part, index) => {
        pathAcc += (index === 0 ? "" : "/") + part;
        const span = document.createElement("span");
        span.textContent = part;

        // Only clickable if not last item
        if (index < parts.length - 1) {
          span.onclick = () => loadDir(pathAcc);
        } else {
          span.classList.add("current");
        }

        breadcrumbEl.appendChild(span);
        if (index < parts.length - 1) breadcrumbEl.appendChild(document.createTextNode(" / "));
      });
    }

    // -----------------------------
    // Load a file (.ini, .pcx, .png)
    // -----------------------------
    async function loadFile(item) {
      fileContent.innerHTML = ""; // clear previous content

      // Show file name
      const title = document.createElement("div");
      title.className = "filename";
      title.textContent = item.name;
      fileContent.appendChild(title);

      if (item.name.endsWith(".ini")) {
        // Load plain text
        const text = await fetch(item.download_url).then(r => r.text());
        const pre = document.createElement("pre");
        pre.textContent = text;
        fileContent.appendChild(pre);
      } else if (item.name.endsWith(".pcx")) {
        // Load PCX image
        const buffer = await fetch(item.download_url).then(r => r.arrayBuffer());
        fileContent.appendChild(decodePCX(buffer));
      } else if (item.name.endsWith(".png")) {
        // Load PNG image
        const img = document.createElement("img");
        img.src = item.download_url;
        fileContent.appendChild(img);
      }
    }

    // -----------------------------
    // Decode PCX image to canvas
    // -----------------------------
    function decodePCX(buffer) {
      const data = new Uint8Array(buffer);
      const view = new DataView(buffer);
      const w = view.getUint16(8, true) - view.getUint16(4, true) + 1;
      const h = view.getUint16(10, true) - view.getUint16(6, true) + 1;

      const pixels = new Uint8Array(w * h);
      let p = 128, i = 0;

      while (i < pixels.length) {
        let v = data[p++];
        if ((v & 0xC0) === 0xC0) {
          let c = v & 0x3F;
          let col = data[p++];
          while (c--) pixels[i++] = col;
        } else pixels[i++] = v;
      }

      const pal = data.slice(data.length - 768);
      const canvas = document.createElement("canvas");
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");
      const img = ctx.createImageData(w, h);

      for (let j = 0; j < pixels.length; j++) {
        const c = pixels[j] * 3;
        img.data[j*4] = pal[c];
        img.data[j*4+1] = pal[c+1];
        img.data[j*4+2] = pal[c+2];
        img.data[j*4+3] = 255;
      }

      ctx.putImageData(img, 0, 0);
      return canvas;
    }

    // -----------------------------
    // Initialize directory view
    // -----------------------------
    loadDir();
  </script>
</body>
</html>
